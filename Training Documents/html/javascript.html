<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Script Table</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.5/js/dataTables.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.5/css/dataTables.dataTables.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        table {
            border: 2px solid;
        }


        label.error {
            color: red;
        }
    </style>

    <script>
        $(document).ready(function () {
            // Function to save data to local storage
            function saveDataToLocalStorage(data) {
                localStorage.setItem('datatableData', JSON.stringify(data));
            }

            // Function to load data from local storage
            function loadDataFromLocalStorage() {
                var data = localStorage.getItem('datatableData');
                if (data) {
                    return JSON.parse(data);
                } else {
                    return [];
                }
            }


            // Initialize DataTable with data from local storage or empty array if no data exists
            var jdata = loadDataFromLocalStorage();
            var table = new DataTable("#mytable", {
                data: jdata,
                columns: [
                    { data: "RollNo" },
                    { data: "Name" },
                    { data: "Dept" },
                    { data: "Year" },
                    { data: "Phone" },
                    { data: "Place" },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<button class="btn btn-primary btn-edit" data-bs-target="#editModal" data-bs-toggle="modal" data-index="' + row.index + '">Edit</button>';
                        }
                    },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<button class="btn btn-danger btn-remove" data-index="' + row.index + '">Remove</button>';
                        }
                    }
                ]
            }); 

            // Function to save data to local storage and update table
            function saveAndRefreshTable(data) {
                saveDataToLocalStorage(data);
                table.clear().rows.add(data).draw();
            }

            // Function to handle remove button click
            $(document).on('click', '.btn-remove', function () {
                var rowData = table.row($(this).closest('tr')).data();
                var rollNoToDelete = rowData.RollNo;

                var indexToDelete = jdata.findIndex(function (item) {
                    return item.RollNo === rollNoToDelete;
                });

                if (indexToDelete !== -1) {
                    jdata.splice(indexToDelete, 1);
                    saveAndRefreshTable(jdata);
                }
            });

            // Function to handle edit button click
            $(document).on('click', '.btn-edit', function () {
                var rowData = table.row($(this).closest('tr')).data();

                // Populate form fields with row data
                $('#edit_rollno').val(rowData.RollNo);
                $('#edit_name').val(rowData.Name);
                $('#edit_dept').val(rowData.Dept);
                $('#edit_year').val(rowData.Year);
                $('#edit_phoneno').val(rowData.Phone);
                $('#edit_place').val(rowData.Place);
            });

            // Validation and submission for edit form
            $("#editForm").validate({
                submitHandler: function (form) {
                    // Retrieve values from form fields
                    var RollNo = $("#edit_rollno").val();
                    var Name = $("#edit_name").val();
                    var Dept = $("#edit_dept").val();
                    var Year = $("#edit_year").val();
                    var Phone = $("#edit_phoneno").val();
                    var Place = $("#edit_place").val();

                    // Update data in jdata
                    var index = jdata.findIndex(function (item) {
                        return item.RollNo == RollNo;
                    });
                    if (index != -1) {
                        jdata[index] = {
                            RollNo: RollNo,
                            Name: Name,
                            Dept: Dept,
                            Year: Year,
                            Phone: Phone,
                            Place: Place,
                        }
                    }

                    // Save updated data to local storage and update table
                    saveAndRefreshTable(jdata);

                    // Reset form and close modal
                    form.reset();
                    $("#editModal").modal('hide');
                },
                // Validation rules
                rules: {
                    edit_name: {
                        required: true,
                        minlength: 3,
                        maxlength: 10
                    },
                    edit_rollno: {
                        required: true,
                        number: "Please enter proper rollno",

                    },
                    edit_dept: {
                        required: true,
                        minlength: 2,
                        maxlength: 4
                    },
                    edit_year: {
                        required: true,
                        number: true,
                        max: 4
                    },
                    edit_phoneno: {
                        required: true,
                        number: true,
                        minlength: 10
                    },
                    edit_place: {
                        required: true,
                        minlength: 3
                    }
                }
            });

            // Validation and submission for add form
            $("#myform").validate({
                submitHandler: function (form) {
                    // Retrieve values from form fields
                    var Name = $("#name").val();
                    var RollNo = $("#rollno").val();
                    var Dept = $("#dept").val();
                    var Year = $("#year").val();
                    var Phoneno = $("#phoneno").val();
                    var Place = $("#place").val();

                    // Add new row to jdata
                    jdata.push({
                        Name: Name,
                        RollNo: RollNo,
                        Dept: Dept,
                        Year: Year,
                        Phone: Phoneno,
                        Place: Place,
                    });

                    // Save updated data to local storage and update table
                    saveAndRefreshTable(jdata);

                    // Reset form and close modal
                    form.reset();
                    $("#addbutton").modal("hide");
                },
                // Validation rules
                rules: {
                    name: {
                        required: true,
                        minlength: 3,
                        maxlength: 10
                    },
                    rollno: {
                        required: true,
                        number: true,
                    },
                    dept: {
                        required: true,
                        minlength: 2,
                        maxlength: 4
                    },
                    year: {
                        required: true,
                        number: true,
                        max: 4
                    },
                    phoneno: {
                        required: true,
                        number: true,
                        minlength: 10
                    },
                    place: {
                        required: true,
                        minlength: 3
                    }

                },
                messages: {
                    name: {
                        minlength: "Name should be at least 3 characters"
                    },
                    rollno: {
                        required: "Please enter your rollno",
                        number: "Please enter proper rollno"
                    },
                    dept: {
                        required: "Please enter your department name",
                        minlength: "Please enter your department name correctly",
                        maxlength: "Please enter your department name as IT,CSE etc..."
                    },
                    year: {
                        required: "Please select your year",
                        max: "Please enter your year within 4"
                    },
                    phoneno: {
                        required: "Please select your phone no",
                        minlength: "Phone no must be 10 numbers"
                    },
                    place: {
                        required: "please enter your place",
                        minlength: "place should be at least 3 characters"
                    }
                }
            
            });
        });

    </script>
    <!-- <script>
        $(document).ready(function () {

            var jdata = [];
            var table = new DataTable("#mytable", {
                data: jdata,
                columns: [

                    { data: "RollNo" },
                    { data: "Name" },
                    { data: "Dept" },
                    { data: "Year" },
                    { data: "Phone" },
                    { data: "Place" },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<button class="btn btn-primary btn-edit" data-bs-target="#editModal" data-bs-toggle="modal" data-index="' + row.index + '">Edit</button>';
                        }
                    },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<button class="btn btn-danger btn-remove" data-index="' + row.index + '">Remove</button>';
                        }
                    }
                ]
            });

            

            // Function to handle edit button click
            $(document).on('click', '.btn-edit', function () {

                var rowData = table.row($(this).closest('tr')).data();

                // Populate form fields with row data

                $('#edit_rollno').val(rowData.RollNo);
                $('#edit_name').val(rowData.Name);
                $('#edit_dept').val(rowData.Dept);
                $('#edit_year').val(rowData.Year);
                $('#edit_phoneno').val(rowData.Phone);
                $('#edit_place').val(rowData.Place);

                // Open the modal
            });

            //script to handle the local storage
            // var dataset = JSON.stringify(rowdata);
            // localStorage.setItem('jdata', dataset);


            // Function to handle remove button click
            $(document).on('click', '.btn-remove', function () {
                var rowData = table.row($(this).closest('tr')).data(); // Get the data of the clicked row
                var rollNoToDelete = rowData.RollNo; // Assuming RollNo is the unique identifier

                var indexToDelete = jdata.findIndex(function (item) {
                    return item.RollNo === rollNoToDelete;
                });

                if (indexToDelete !== -1) {
                    jdata.splice(indexToDelete, 1); // Remove the row from data array
                    table.clear().rows.add(jdata).draw(); // Redraw the table
                }
            });


            $("#editForm").validate({
                submitHandler: function (form) {
                    var RollNo = $("#edit_rollno").val();

                    var Name = $("#edit_name").val();
                    var Dept = $("#edit_dept").val();
                    var Year = $("#edit_year").val();
                    var Phone = $("#edit_phoneno").val();
                    var Place = $("#edit_place").val();

                    var index = jdata.findIndex(function (item) {
                        return item.RollNo == RollNo;
                    });
                    if (index != -1) {
                        jdata[index] = {
                            RollNo: RollNo,
                            Name: Name,
                            Dept: Dept,
                            Year: Year,
                            Phone: Phone,
                            Place: Place,
                        }
                    }
                    table.clear().rows.add(jdata).draw();
                    form.reset();
                    $("#editModal").modal('hide')

                },
                rules: {
                    edit_name: {
                        required: true,
                        minlength: 3,
                        maxlength: 10
                    },
                    edit_rollno: {
                        required: true,
                        number: "Please enter proper rollno",

                    },
                    edit_dept: {
                        required: true,
                        minlength: 2,
                        maxlength: 4
                    },
                    edit_year: {
                        required: true,
                        number: true,
                        max: 4
                    },
                    edit_phoneno: {
                        required: true,
                        number: true,
                        minlength: 10
                    },
                    edit_place: {
                        required: true,
                        minlength: 3
                    }
                }
            });


            $("#myform").validate({
                submitHandler: function (form) {
                    var Name = $("#name").val();
                    var RollNo = $("#rollno").val();
                    var Dept = $("#dept").val();
                    var Year = $("#year").val();
                    var Phoneno = $("#phoneno").val();
                    var Place = $("#place").val();

                    jdata.push({
                        Name: Name,
                        RollNo: RollNo,
                        Dept: Dept,
                        Year: Year,
                        Phone: Phoneno,
                        Place: Place,
                    });

                    table.clear().rows.add(jdata).draw();
                    form.reset(); // Clear form after submission 
                    $("#addbutton").modal("hide");
                },

                rules: {
                    name: {
                        required: true,
                        minlength: 3,
                        maxlength: 10
                    },
                    rollno: {
                        required: true,
                        number: true,
                    },
                    dept: {
                        required: true,
                        minlength: 2,
                        maxlength: 4
                    },
                    year: {
                        required: true,
                        number: true,
                        max: 4
                    },
                    phoneno: {
                        required: true,
                        number: true,
                        minlength: 10
                    },
                    place: {
                        required: true,
                        minlength: 3
                    }

                },
                messages: {
                    name: {
                        minlength: "Name should be at least 3 characters"
                    },
                    rollno: {
                        required: "Please enter your rollno",
                        number: "Please enter proper rollno"
                    },
                    dept: {
                        required: "Please enter your department name",
                        minlength: "Please enter your department name correctly",
                        maxlength: "Please enter your department name as IT,CSE etc..."
                    },
                    year: {
                        required: "Please select your date of birth",
                        maxlength: "Please enter your year within 4"
                    },
                    phoneno: {
                        required: "Please select your phone no",
                        minlenth: "Phone no must be 10 numbers"
                    },
                    place: {
                        required: "please enter your place",
                        minlength: "place should be at least 3 characters"
                    }
                }
            });


        });
    </script> -->

</head>

<body>
    <div class="row justify-content-end">
        <div class="col-1">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addbutton">
                Add
            </button>
        </div>
    </div>
    <div class="modal fade" id="addbutton" tabindex="-1" aria-labelledby="addbuttonLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addbuttonLabel">Add New Row</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="myform">

                        <div class="row mb-3">
                            <label for="rollno" class="col-sm-2 col-form-label">RollNo</label>
                            <div class="col-sm-10">
                                <input type="text" name="rollno" class="form-control" id="rollno">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="name" class="col-sm-2 col-form-label">Name</label>
                            <div class="col-sm-10">
                                <input type="text" name="name" class="form-control" id="name">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="dept" class="col-sm-2 col-form-label">Dept</label>
                            <div class="col-sm-10">
                                <input type="dept" name="dept" class="form-control" id="dept">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="year" class="col-sm-2 col-form-label">Year</label>
                            <div class="col-sm-10">
                                <input type="text" name="year" class="form-control" id="year">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="phoneno" class="col-sm-2 col-form-label">Phone</label>
                            <div class="col-sm-10">
                                <input type="text" name="phoneno" class="form-control" id="phoneno">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="place" class="col-sm-2 col-form-label">Place</label>
                            <div class="col-sm-10">
                                <input type="text" name="place" class="form-control" id="place">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="reset" class="btn btn-danger">Cancel</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Row Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <!-- Edit modal content -->
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Row</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="edit-index">

                        <div class="row mb-3">
                            <label for="edit-rollno" class="col-sm-2 col-form-label">RollNo</label>
                            <div class="col-sm-10">
                                <input type="text" name="edit_rollno" class="form-control" id="edit_rollno" disabled>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="edit-name" class="col-sm-2 col-form-label">Name</label>
                            <div class="col-sm-10">
                                <input type="text" name="edit_name" class="form-control" id="edit_name">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="edit-dept" class="col-sm-2 col-form-label">Dept</label>
                            <div class="col-sm-10">
                                <input type="text" name="edit_dept" class="form-control" id="edit_dept">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="edit-year" class="col-sm-2 col-form-label">Year</label>
                            <div class="col-sm-10">
                                <input type="text" name="edit_year" class="form-control" id="edit_year">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="edit-phoneno" class="col-sm-2 col-form-label">Phone</label>
                            <div class="col-sm-10">
                                <input type="text" name="edit_phoneno" class="form-control" id="edit_phoneno">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="edit-place" class="col-sm-2 col-form-label">Place</label>
                            <div class="col-sm-10">
                                <input type="text" name="edit_place" class="form-control" id="edit_place">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--table-->

    <table id="mytable" width="100%">
        <thead>
            <tr>
                <th>RollNo</th>
                <th>Name</th>
                <th>Department</th>
                <th>Year</th>
                <th>Phone no</th>
                <th>Place</th>
                <th>Action</th>
                <th>Action</th>
            </tr>
        </thead>


    </table>
</body>

</html>